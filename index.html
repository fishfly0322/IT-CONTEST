<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>114å­¸å¹´åº¦ æ ¡å…§è³‡è¨Šæ¯”è³½å ±åç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            min-height: 100vh;
        }
        .bg-circle { position: fixed; border-radius: 50%; background: rgba(255, 255, 255, 0.1); z-index: -1; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .rule-card { border-left: 4px solid #4f46e5; transition: 0.3s; }
        .admin-login-box { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100; }
    </style>
</head>
<body class="py-8 px-4">

<div class="bg-circle w-64 h-64 -top-20 -left-20"></div>
<div class="bg-circle w-96 h-96 -bottom-32 -right-32"></div>

<div class="max-w-6xl mx-auto">
    <div class="text-center mb-10 text-white">
        <h1 class="text-4xl md:text-5xl font-bold mb-4 drop-shadow-2xl">ğŸ† æ ¡å…§è³‡è¨Šæ¯”è³½å ±åå¹³å°</h1>
        <div class="inline-block bg-white/20 px-4 py-1 rounded-full text-sm backdrop-blur-sm">å„é …æ¯”è³½é™é¡ 35 äººï¼Œè«‹å„˜æ—©å ±å</div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <div class="lg:col-span-5">
            <div class="glass p-8 rounded-3xl shadow-2xl h-full">
                <h2 class="text-2xl font-bold text-indigo-800 mb-6 flex items-center border-b pb-2">ğŸ“‹ æ¯”è³½è¾¦æ³•æ‘˜è¦</h2>
                <div class="space-y-4 overflow-y-auto max-h-[550px] pr-2 text-sm text-gray-700">
                    <div class="rule-card p-4 bg-indigo-50/50 rounded-r-xl">
                        <h3 class="font-bold text-indigo-700 text-base mb-1">âŒ¨ï¸ ä¸­è‹±æ–‡æ–‡ç« è¼¸å…¥</h3>
                        <p>â€¢ 7-8ã€10-11å¹´ç´šï¼šæ¯ç­è‡³å°‘1äººã€‚</p>
                        <p>â€¢ é›™èª/åœ‹éš›ç­ï¼šå ±åè‹±æ–‡è¼¸å…¥ï¼Œæ¯ç­è‡³å°‘2äººã€‚</p>
                    </div>
                    <div class="rule-card p-4 bg-indigo-50/50 rounded-r-xl">
                        <h3 class="font-bold text-indigo-700 text-base mb-1">ğŸ“Š é›»è…¦ç°¡å ±è¨­è¨ˆ</h3>
                        <p>â€¢ éœ€æ–¼ 5/22(äº”) å‰ä¸Šå‚³ã€‚æª”æ¡ˆæ ¼å¼ï¼špptxã€‚</p>
                    </div>
                    <div class="rule-card p-4 bg-indigo-50/50 rounded-r-xl">
                        <h3 class="font-bold text-indigo-700 text-base mb-1">ğŸ’» é›»è…¦ç¨‹å¼è¨­è¨ˆ</h3>
                        <p>â€¢ åœ‹ä¸­ï¼šScratchã€‚é«˜ä¸­ï¼šä¸é™èªè¨€ã€‚æ¯ç­è‡³å¤š 2 äººã€‚</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="lg:col-span-7">
            <div class="glass p-8 rounded-3xl shadow-2xl">
                <h2 class="text-2xl font-bold text-gray-800 mb-8 flex items-center border-b pb-2">âœï¸ å¡«å¯«å ±åè³‡è¨Š</h2>
                <form id="registrationForm" class="space-y-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-600 mb-2">é¸æ“‡ç­ç´š</label>
                            <select id="classInput" required class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:border-indigo-500 transition outline-none bg-white">
                                <option value="" disabled selected>è«‹é¸æ“‡ç­ç´š</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-600 mb-2">åº§è™Ÿ</label>
                            <input type="number" id="seatInput" min="1" max="60" required class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:border-indigo-500 outline-none" placeholder="1-60">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-600 mb-2">å­¸ç”Ÿå§“å</label>
                        <input type="text" id="nameInput" required class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:border-indigo-500 outline-none" placeholder="è«‹è¼¸å…¥å…¨å">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-600 mb-2">å ±åæ¯”è³½é …ç›®</label>
                        <select id="eventInput" required class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:border-indigo-500 transition outline-none bg-white">
                            <option value="" disabled selected>è«‹é¸æ“‡æ¯”è³½é …ç›®</option>
                            <option value="ä¸­æ–‡æ–‡ç« è¼¸å…¥">ä¸­æ–‡æ–‡ç« è¼¸å…¥</option>
                            <option value="è‹±æ–‡æ–‡ç« è¼¸å…¥">è‹±æ–‡æ–‡ç« è¼¸å…¥</option>
                            <option value="é›»è…¦ç°¡å ±è¨­è¨ˆ">é›»è…¦ç°¡å ±è¨­è¨ˆ</option>
                            <option value="å°ˆé¡Œå¯«ä½œ">é›»è…¦å°ˆé¡Œå¯«ä½œ</option>
                            <option value="é›»è…¦ç¨‹å¼è¨­è¨ˆ">é›»è…¦ç¨‹å¼è¨­è¨ˆ</option>
                            <option value="é›»ç¹ªæµ·å ±è¨­è¨ˆ">é›»ç¹ªæµ·å ±è¨­è¨ˆ</option>
                        </select>
                    </div>
                    <button type="submit" id="submitBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl shadow-xl transition active:scale-95 text-lg">
                        ç¢ºèªä¸¦æäº¤å ±å
                    </button>
                </form>
                
                <div class="mt-8 text-center border-t pt-4">
                    <button onclick="showLoginBox()" class="text-xs text-gray-400 hover:text-indigo-600 transition">âš™ï¸ ç®¡ç†å“¡å…¥å£</button>
                </div>
            </div>
        </div>
    </div>

    <div id="loginBox" class="admin-login-box glass p-6 rounded-2xl shadow-2xl w-80 text-center">
        <h3 class="font-bold text-gray-800 mb-4">ç®¡ç†å“¡é©—è­‰</h3>
        <input type="password" id="pwField" placeholder="å¯†ç¢¼" class="w-full px-4 py-2 border rounded-lg mb-4 text-center">
        <div class="flex gap-2">
            <button onclick="hideLoginBox()" class="flex-1 px-4 py-2 bg-gray-200 rounded-lg text-sm font-bold">å–æ¶ˆ</button>
            <button onclick="checkPassword()" class="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-bold">ç™»å…¥</button>
        </div>
    </div>

    <div id="adminSection" class="hidden mt-12 glass p-10 rounded-3xl shadow-2xl border-2 border-indigo-200">
        <h2 class="text-3xl font-bold text-gray-800 mb-10">ğŸ“Š è³½äº‹ç®¡ç†ä¸­å¿ƒ</h2>
        <div id="eventStatsBody" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12"></div>
        <div class="overflow-x-auto rounded-2xl border bg-white shadow-sm">
            <table class="w-full text-left">
                <thead class="bg-gray-800 text-white">
                    <tr><th class="px-6 py-4">ç­ç´š</th><th class="px-6 py-4">åº§è™Ÿ</th><th class="px-6 py-4">å§“å</th><th class="px-6 py-4">é …ç›®</th><th class="px-6 py-4">æ“ä½œ</th></tr>
                </thead>
                <tbody id="detailListBody" class="divide-y divide-gray-100 bg-white"></tbody>
            </table>
        </div>
        <div class="mt-8">
            <button onclick="exportToCSV()" class="bg-green-600 text-white px-6 py-2 rounded-lg font-bold mr-4">åŒ¯å‡º Excel</button>
            <button onclick="clearData()" class="text-red-400 text-xs">æ¸…ç©ºè³‡æ–™</button>
        </div>
    </div>
</div>

<script>
    // --- åŸºç¤è¨­å®š ---
    const SECRET_KEY = "YWRtaW44ODg="; // admin888
    const GAS_URL = "https://script.google.com/macros/s/AKfycbw_gE3ED4tpQP9Fjd_rCFvn_OkZoDpJFuYJH-FQCg1Cj_n_e65Nnjl9pjZp_mrnOQ9O/exec"; 
    const MAX_LIMIT = 35;
    const events = ["ä¸­æ–‡æ–‡ç« è¼¸å…¥", "è‹±æ–‡æ–‡ç« è¼¸å…¥", "é›»è…¦ç°¡å ±è¨­è¨ˆ", "å°ˆé¡Œå¯«ä½œ", "é›»è…¦ç¨‹å¼è¨­è¨ˆ", "é›»ç¹ªæµ·å ±è¨­è¨ˆ"];
    
    // --- ç­ç´šæ¸…å–®é‚è¼¯ (ä¿®æ­£ç‰ˆ) ---
    const allClasses = [];
    // 7-9 å¹´ç´šå„ 10 ç­
    for (let g = 7; g <= 9; g++) { for (let r = 1; r <= 10; r++) allClasses.push(`${g}-${r}`); }
    // 10-12 å¹´ç´šå„ 7 ç­
    for (let g = 10; g <= 12; g++) { for (let r = 1; r <= 7; r++) allClasses.push(`${g}-${r}`); }

    // åˆå§‹åŒ–ç­ç´šä¸‹æ‹‰é¸å–®
    const classSelect = document.getElementById('classInput');
    allClasses.forEach(cls => {
        const opt = document.createElement('option');
        opt.value = cls;
        opt.innerText = cls + " ç­";
        classSelect.appendChild(opt);
    });

    let registrations = JSON.parse(localStorage.getItem('registrations')) || [];

    // --- å ±åæäº¤ ---
    document.getElementById('registrationForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const event = document.getElementById('eventInput').value;
        const currentCount = registrations.filter(r => r.event === event).length;
        
        if (currentCount >= MAX_LIMIT) {
            alert(`âš ï¸ ã€${event}ã€‘åé¡å·²æ»¿ï¼`);
            return;
        }

        const formData = {
            className: document.getElementById('classInput').value,
            seat: document.getElementById('seatInput').value,
            name: document.getElementById('nameInput').value,
            event: event
        };

        const btn = document.getElementById('submitBtn');
        btn.innerText = "ğŸš€ é›²ç«¯åŒæ­¥ä¸­...";
        btn.disabled = true;

        try {
            // ç™¼é€åˆ° Google è©¦ç®—è¡¨
            await fetch(GAS_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(formData) });
            
            registrations.push({ ...formData, id: Date.now() });
            localStorage.setItem('registrations', JSON.stringify(registrations));
            alert("âœ… å ±åæˆåŠŸï¼");
            e.target.reset();
            updateDashboard();
        } catch (err) {
            alert("âŒ å‚³é€å¤±æ•—ï¼Œè«‹ç¢ºèªç¶²è·¯æˆ– GAS ç¶²å€ã€‚");
        } finally {
            btn.innerText = "ç¢ºèªä¸¦æäº¤å ±å";
            btn.disabled = false;
        }
    });

    // --- ç®¡ç†åŠŸèƒ½ ---
    function showLoginBox() { document.getElementById('loginBox').style.display = 'block'; }
    function hideLoginBox() { document.getElementById('loginBox').style.display = 'none'; }
    function checkPassword() {
        if (btoa(document.getElementById('pwField').value) === SECRET_KEY) {
            hideLoginBox();
            document.getElementById('adminSection').classList.remove('hidden');
            updateDashboard();
        } else { alert("å¯†ç¢¼éŒ¯èª¤ï¼"); }
    }

    function updateDashboard() {
        const detailBody = document.getElementById('detailListBody');
        const eventStatsBody = document.getElementById('eventStatsBody');

        detailBody.innerHTML = registrations.sort((a,b) => a.className.localeCompare(b.className, undefined, {numeric: true}))
            .map(r => `<tr class="hover:bg-gray-50"><td class="px-6 py-4 font-bold text-indigo-900">${r.className}</td><td class="px-6 py-4">${r.seat}</td><td class="px-6 py-4">${r.name}</td><td class="px-6 py-4"><span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs">${r.event}</span></td><td class="px-6 py-4"><button onclick="deleteRecord(${r.id})" class="text-red-400 text-sm">åˆªé™¤</button></td></tr>`).join('');

        eventStatsBody.innerHTML = events.map(evt => {
            const count = registrations.filter(r => r.event === evt).length;
            const percent = Math.min((count / MAX_LIMIT) * 100, 100);
            return `<div class="bg-white p-5 rounded-2xl border shadow-sm">
                <div class="flex justify-between mb-2"><b>${evt}</b><span class="text-sm font-bold">${count}/${MAX_LIMIT}</span></div>
                <div class="w-full bg-gray-100 h-2 rounded-full"><div class="bg-indigo-600 h-2 rounded-full transition-all" style="width:${percent}%"></div></div>
            </div>`;
        }).join('');
    }

    function deleteRecord(id) {
        if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç­†è³‡æ–™ï¼Ÿ")) {
            registrations = registrations.filter(r => r.id !== id);
            localStorage.setItem('registrations', JSON.stringify(registrations));
            updateDashboard();
        }
    }

    function exportToCSV() {
        let csv = "\ufeffç­ç´š,åº§è™Ÿ,å§“å,é …ç›®\n" + registrations.map(r => `${r.className},${r.seat},${r.name},${r.event}`).join("\n");
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `å ±ååå–®_${new Date().toLocaleDateString()}.csv`;
        a.click();
    }

    function clearData() { if(confirm("ç¢ºå®šæ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼Ÿ")) { localStorage.clear(); location.reload(); } }
</script>

</body>
</html>