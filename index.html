<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>114å­¸å¹´åº¦å¤§åŒé«˜ä¸­è³‡è¨Šæ¯”è³½å ±åç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            min-height: 100vh;
        }
        .bg-circle { position: fixed; border-radius: 50%; background: rgba(255, 255, 255, 0.1); z-index: -1; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .rule-card { border-left: 4px solid #4f46e5; transition: 0.3s; }
        .rule-card:hover { background-color: #f5f3ff; }
        .admin-login-box { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 100; }
    </style>
</head>
<body class="py-8 px-4">

<div class="bg-circle w-64 h-64 -top-20 -left-20"></div>
<div class="bg-circle w-96 h-96 -bottom-32 -right-32"></div>

<div class="max-w-6xl mx-auto">
    <div class="text-center mb-10 text-white">
        <h1 class="text-4xl md:text-5xl font-bold mb-4 drop-shadow-2xl">ğŸ† æ ¡å…§è³‡è¨Šæ¯”è³½å ±åå¹³å°</h1>
        <div class="inline-block bg-white/20 px-4 py-1 rounded-full text-sm backdrop-blur-sm">å„é …æ¯”è³½é™é¡ 35 äººï¼Œè«‹å„˜æ—©å ±å</div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <div class="lg:col-span-5">
            <div class="glass p-8 rounded-3xl shadow-2xl h-full">
                <h2 class="text-2xl font-bold text-indigo-800 mb-6 flex items-center border-b pb-2">ğŸ“‹ æ¯”è³½è¾¦æ³•æ‘˜è¦</h2>
                <div class="space-y-4 overflow-y-auto max-h-[550px] pr-2 text-sm text-gray-700">
                    <div class="rule-card p-4 bg-indigo-50/50 rounded-r-xl">
                        <h3 class="font-bold text-indigo-700 text-base mb-1">âŒ¨ï¸ ä¸­è‹±æ–‡æ–‡ç« è¼¸å…¥</h3>
                        <p>â€¢ 7-8ã€10-11å¹´ç´šï¼šæ¯ç­è‡³å°‘1äººã€‚</p>
                        <p>â€¢ åœ‹éš›/é›™èªç­ï¼šå ±åè‹±æ–‡è¼¸å…¥ï¼Œæ¯ç­è‡³å°‘2äººã€‚</p>
                    </div>
                    <div class="rule-card p-4 bg-indigo-50/50 rounded-r-xl">
                        <h3 class="font-bold text-indigo-700 text-base mb-1">ğŸ“Š é›»è…¦ç°¡å ±è¨­è¨ˆ</h3>
                        <p>â€¢ æ¯ç­è‡³å°‘1äººã€‚éœ€æ–¼ <span class="text-red-500 font-bold underline">5/22(äº”)</span> å‰ä¸Šå‚³ pptx æª”ã€‚</p>
                    </div>
                    <div class="rule-card p-4 bg-indigo-50/50 rounded-r-xl">
                        <h3 class="font-bold text-indigo-700 text-base mb-1">ğŸ“ é›»è…¦å°ˆé¡Œå¯«ä½œ</h3>
                        <p>â€¢ æ¯ç­è‡³å°‘1äººã€‚Word è½‰ <strong>PDF</strong> å¾Œä¸Šå‚³ã€‚</p>
                    </div>
                    <div class="rule-card p-4 bg-indigo-50/50 rounded-r-xl">
                        <h3 class="font-bold text-indigo-700 text-base mb-1">ğŸ’» é›»è…¦ç¨‹å¼è¨­è¨ˆ</h3>
                        <p>â€¢ åœ‹ä¸­(Scratch)ï¼š1-2 äººã€‚é«˜ä¸­ï¼šè‡³å¤š 2 äººã€‚</p>
                    </div>
                    <div class="rule-card p-4 bg-indigo-50/50 rounded-r-xl">
                        <h3 class="font-bold text-indigo-700 text-base mb-1">ğŸ¨ é›»ç¹ªæµ·å ±è¨­è¨ˆ</h3>
                        <p>â€¢ ç¾è¡“ç­ï¼šä»¥ç­ç´šç‚ºå–®ä½åƒåŠ ã€‚</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 text-xs text-yellow-800 leading-relaxed italic">
                        ï¼Š9ã€12å¹´ç´šåŠé«”è‚²ç­å­¸ç”Ÿæ¡è‡ªç”±å ±åæ–¹å¼ã€‚
                    </div>
                </div>
            </div>
        </div>

        <div class="lg:col-span-7">
            <div class="glass p-8 rounded-3xl shadow-2xl">
                <h2 class="text-2xl font-bold text-gray-800 mb-8 flex items-center border-b pb-2">âœï¸ å¡«å¯«å ±åè³‡è¨Š</h2>
                <form id="registrationForm" class="space-y-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-600 mb-2">ç­ç´š (å¦‚: 101)</label>
                            <input type="text" id="classInput" required class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:border-indigo-500 focus:ring-0 transition outline-none" placeholder="è«‹è¼¸å…¥ç­ç´š">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-600 mb-2">åº§è™Ÿ</label>
                            <input type="number" id="seatInput" required class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:border-indigo-500 focus:ring-0 transition outline-none" placeholder="1-50">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-600 mb-2">å­¸ç”Ÿå§“å</label>
                        <input type="text" id="nameInput" required class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:border-indigo-500 focus:ring-0 transition outline-none" placeholder="è«‹è¼¸å…¥çœŸå¯¦å§“å">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-600 mb-2">å ±åæ¯”è³½é …ç›®</label>
                        <select id="eventInput" class="w-full px-4 py-3 border-2 border-gray-100 rounded-xl focus:border-indigo-500 focus:ring-0 transition outline-none bg-white">
                            <option value="ä¸­æ–‡æ–‡ç« è¼¸å…¥">ä¸­æ–‡æ–‡ç« è¼¸å…¥</option>
                            <option value="è‹±æ–‡æ–‡ç« è¼¸å…¥">è‹±æ–‡æ–‡ç« è¼¸å…¥</option>
                            <option value="é›»è…¦ç°¡å ±è¨­è¨ˆ">é›»è…¦ç°¡å ±è¨­è¨ˆ (4/25æˆªæ­¢)</option>
                            <option value="å°ˆé¡Œå¯«ä½œ">å°ˆé¡Œå¯«ä½œ (4/25æˆªæ­¢)</option>
                            <option value="é›»è…¦ç¨‹å¼è¨­è¨ˆ">é›»è…¦ç¨‹å¼è¨­è¨ˆ</option>
                            <option value="é›»ç¹ªæµ·å ±è¨­è¨ˆ">é›»ç¹ªæµ·å ±è¨­è¨ˆ</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl shadow-xl transform transition hover:-translate-y-1 active:scale-95 text-lg">
                        ç¢ºèªä¸¦æäº¤å ±å
                    </button>
                </form>
                
                <div class="mt-8 text-center border-t pt-4">
                    <button onclick="showLoginBox()" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-full text-xs font-medium text-gray-400 hover:text-indigo-600 hover:border-indigo-600 transition">
                        <span class="mr-1">âš™ï¸</span> ç®¡ç†å“¡ç¶­è­·å…¥å£
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="loginBox" class="admin-login-box glass p-6 rounded-2xl shadow-2xl w-80 text-center">
        <h3 class="font-bold text-gray-800 mb-4">ç®¡ç†å“¡é©—è­‰</h3>
        <input type="password" id="pwField" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" class="w-full px-4 py-2 border rounded-lg mb-4 text-center outline-none focus:ring-2 focus:ring-indigo-500">
        <div class="flex gap-2">
            <button onclick="hideLoginBox()" class="flex-1 px-4 py-2 bg-gray-200 rounded-lg text-sm">å–æ¶ˆ</button>
            <button onclick="checkPassword()" class="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-bold">ç™»å…¥</button>
        </div>
    </div>

    <div id="adminSection" class="hidden mt-12 glass p-10 rounded-3xl shadow-2xl border-2 border-indigo-200">
        <div class="flex flex-col md:flex-row justify-between items-center mb-10 gap-4">
            <h2 class="text-3xl font-bold text-gray-800 flex items-center">ğŸ“Š è³½äº‹ç®¡ç†ä¸­å¿ƒ <span class="ml-3 text-sm font-normal bg-indigo-100 text-indigo-600 px-2 py-1 rounded">ç®¡ç†å“¡å·²ç™»å…¥</span></h2>
            <button onclick="exportToCSV()" class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-2xl font-bold shadow-lg transition flex items-center">
                <span class="mr-2">ğŸ“¥</span> åŒ¯å‡º Excel æ¸…å–®
            </button>
        </div>

        <div id="eventStatsBody" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12"></div>

        <div class="overflow-x-auto rounded-2xl border border-gray-100 shadow-sm">
            <table class="w-full text-left">
                <thead class="bg-gray-800 text-white">
                    <tr>
                        <th class="px-6 py-4">ç­ç´š</th><th class="px-6 py-4">åº§è™Ÿ</th><th class="px-6 py-4">å§“å</th><th class="px-6 py-4">å ±åé …ç›®</th><th class="px-6 py-4">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="detailListBody" class="divide-y divide-gray-100 bg-white"></tbody>
            </table>
        </div>
        <div class="mt-10 flex justify-between items-end border-t pt-6">
            <button onclick="clearData()" class="text-red-300 hover:text-red-600 text-xs transition">âš ï¸ æ¸…ç©ºæ‰€æœ‰å ±åè³‡æ–™</button>
            <div class="text-right">
                <p class="text-xs text-gray-400 mb-1">æœªå ±åç­ç´šæ¸…å–®</p>
                <p id="unregisteredClasses" class="text-sm text-gray-600 max-w-md"></p>
            </div>
        </div>
    </div>
</div>

<script>
    const SECRET_KEY = "YWRtaW44ODg=";
    const MAX_LIMIT = 35;
    const events = ["ä¸­æ–‡æ–‡ç« è¼¸å…¥", "è‹±æ–‡æ–‡ç« è¼¸å…¥", "é›»è…¦ç°¡å ±è¨­è¨ˆ", "å°ˆé¡Œå¯«ä½œ", "é›»è…¦ç¨‹å¼è¨­è¨ˆ", "é›»ç¹ªæµ·å ±è¨­è¨ˆ"];
    const allClasses = ["701", "702", "703", "801", "802", "803", "101", "102", "111", "112"]; 

    let registrations = JSON.parse(localStorage.getItem('registrations')) || [];

    // --- ç™»å…¥æ§åˆ¶ ---
    function showLoginBox() { document.getElementById('loginBox').style.display = 'block'; document.getElementById('pwField').focus(); }
    function hideLoginBox() { document.getElementById('loginBox').style.display = 'none'; document.getElementById('pwField').value = ''; }
    
    function checkPassword() {
        const input = document.getElementById('pwField').value;
        if (btoa(input) === SECRET_KEY) {
            hideLoginBox();
            document.getElementById('adminSection').classList.remove('hidden');
            updateDashboard();
            window.scrollTo({ top: document.getElementById('adminSection').offsetTop - 50, behavior: 'smooth' });
        } else {
            alert("å¯†ç¢¼ä¸æ­£ç¢ºï¼");
        }
    }

    // --- å ±åé‚è¼¯ ---
    // --- é›²ç«¯åŒæ­¥è¨­å®š ---
    // è«‹åœ¨é€™è£¡è²¼ä¸Šä½ çš„ Google Apps Script ç¶²é æ‡‰ç”¨ç¨‹å¼ç¶²å€
    const GAS_URL = "https://script.google.com/macros/s/AKfycbw_gE3ED4tpQP9Fjd_rCFvn_OkZoDpJFuYJH-FQCg1Cj_n_e65Nnjl9pjZp_mrnOQ9O/exec"; 

    // --- å ±åé‚è¼¯ (å·²å‡ç´šé›²ç«¯åŒæ­¥ç‰ˆ) ---
    document.getElementById('registrationForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const event = document.getElementById('eventInput').value;
        const currentCount = registrations.filter(r => r.event === event).length;
        
        if (currentCount >= MAX_LIMIT) {
            alert(`âš ï¸ æŠ±æ­‰ï¼Œã€${event}ã€‘åé¡å·²æ»¿ 35 äººï¼Œè«‹è€ƒæ…®å ±åå…¶ä»–é …ç›®ã€‚`);
            return;
        }

        const formData = {
            className: document.getElementById('classInput').value,
            seat: document.getElementById('seatInput').value,
            name: document.getElementById('nameInput').value,
            event: event
        };

        // æŒ‰éˆ•å‹•ç•«å›é¥‹
        const btn = e.target.querySelector('button');
        const originalText = btn.innerText;
        btn.innerText = "ğŸš€ é›²ç«¯å‚³é€ä¸­...";
        btn.disabled = true;

        try {
            // ç™¼é€è³‡æ–™åˆ° Google è©¦ç®—è¡¨
            await fetch(GAS_URL, {
                method: "POST",
                mode: "no-cors", 
                body: JSON.stringify(formData)
            });

            // åŒæ­¥å­˜åˆ°æœ¬åœ° (è®“ç®¡ç†å¾Œå°èƒ½å³æ™‚çœ‹åˆ°)
            const newEntry = { ...formData, id: Date.now() };
            registrations.push(newEntry);
            localStorage.setItem('registrations', JSON.stringify(registrations));
            
            alert(`âœ… å ±åæˆåŠŸï¼\nè³‡æ–™å·²æˆåŠŸå‚™ä»½è‡³é›²ç«¯è©¦ç®—è¡¨ã€‚`);
            e.target.reset();
            updateDashboard();
        } catch (error) {
            console.error(error);
            alert("âŒ é›²ç«¯åŒæ­¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚");
        } finally {
            btn.innerText = originalText;
            btn.disabled = false;
        }
    });

    // --- æ›´æ–°æ•¸æ“šçœ‹æ¿ ---
    function updateDashboard() {
        const detailBody = document.getElementById('detailListBody');
        const eventStatsBody = document.getElementById('eventStatsBody');

        detailBody.innerHTML = registrations.sort((a,b) => a.className.localeCompare(b.className))
            .map(r => `
                <tr class="hover:bg-indigo-50/50 transition">
                    <td class="px-6 py-4 font-bold text-indigo-900">${r.className}</td>
                    <td class="px-6 py-4 text-gray-500">${r.seat}</td>
                    <td class="px-6 py-4 font-medium text-gray-800">${r.name}</td>
                    <td class="px-6 py-4"><span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-lg text-xs font-bold">${r.event}</span></td>
                    <td class="px-6 py-4"><button onclick="deleteRecord(${r.id})" class="text-red-400 hover:text-red-600 transition">åˆªé™¤</button></td>
                </tr>
            `).join('');

        eventStatsBody.innerHTML = events.map(evt => {
            const count = registrations.filter(r => r.event === evt).length;
            const percent = (count / MAX_LIMIT) * 100;
            const barColor = count >= MAX_LIMIT ? 'bg-red-500' : 'bg-indigo-600';
            return `
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                    <div class="flex justify-between items-center mb-3">
                        <span class="font-bold text-gray-700">${evt}</span>
                        <span class="text-xs font-black ${count >= MAX_LIMIT ? 'text-red-500' : 'text-indigo-600'}">${count} / ${MAX_LIMIT}</span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-2.5">
                        <div class="${barColor} h-2.5 rounded-full transition-all duration-500" style="width: ${percent}%"></div>
                    </div>
                </div>
            `;
        }).join('');

        const reged = [...new Set(registrations.map(r => r.className))];
        const missing = allClasses.filter(c => !reged.includes(c));
        document.getElementById('unregisteredClasses').innerText = missing.length > 0 ? missing.join(', ') : 'æ‰€æœ‰ç­ç´šçš†å·²å ±åï¼';
    }

    function deleteRecord(id) {
        if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†å ±åè³‡æ–™å—ï¼Ÿ")) {
            registrations = registrations.filter(r => r.id !== id);
            localStorage.setItem('registrations', JSON.stringify(registrations));
            updateDashboard();
        }
    }

    function exportToCSV() {
        if (registrations.length === 0) return alert("ç›®å‰æ²’æœ‰è³‡æ–™ã€‚");
        let csv = "\ufeffç­ç´š,åº§è™Ÿ,å§“å,é …ç›®\n" + registrations.map(r => `${r.className},${r.seat},${r.name},${r.event}`).join("\n");
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `æ¯”è³½å ±ååå–®_${new Date().getMonth()+1}${new Date().getDate()}.csv`;
        a.click();
    }

    function clearData() { if(confirm("ç¢ºå®šæ¸…ç©ºï¼Ÿ")) { localStorage.clear(); location.reload(); } }

    updateDashboard();
</script>

</body>
</html>